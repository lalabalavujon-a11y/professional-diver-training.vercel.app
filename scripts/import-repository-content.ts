// Import content from both GitHub repositories
import { db } from "../server/db";

// ALST Lessons Content
const alstLessonsContent = [
  {
    title: 'AI Tutor: ALST Fundamentals',
    content: `# AI Tutor: Assistant Life Support Technician Fundamentals

## Welcome to Your ALST AI Tutor

I'm your specialized AI tutor for Assistant Life Support Technician training. I'll guide you through the essential skills needed to support life support systems in diving operations.

## Learning Objectives
- Master life support system components
- Understand gas management principles
- Learn environmental control systems
- Develop emergency response skills
- Practice equipment maintenance procedures

## Life Support System Components

### Gas Management Systems
**Primary Gas Supply**: High-pressure gas storage and distribution
**Gas Analysis**: Continuous monitoring of gas composition
**Flow Control**: Regulated gas delivery to chambers
**Backup Supply**: Independent backup gas systems

**AI Tutor Tip**: Gas management is the heart of life support. Always maintain redundant systems.

### Environmental Control Systems
**Temperature Control**: Heating and cooling systems
**Humidity Control**: Moisture management
**Air Circulation**: Ventilation and filtration
**CO₂ Removal**: Chemical or mechanical scrubbers

### Monitoring Systems
**Gas Analyzers**: Oxygen, helium, CO₂ monitoring
**Environmental Sensors**: Temperature, humidity, pressure
**Alarm Systems**: Automatic warning systems
**Data Logging**: Continuous record keeping

## Gas Management Principles

### Oxygen Control
**Safe Range**: 0.4-0.6 ATA oxygen partial pressure
**Monitoring**: Continuous oxygen analysis
**Control**: Automatic and manual adjustment
**Safety**: Backup oxygen supply

### Helium Management
**Primary Diluent**: Helium for deep diving
**Analysis**: Helium concentration monitoring
**Supply**: High-pressure helium storage
**Conservation**: Efficient gas usage

### CO₂ Removal
**Scrubber Systems**: Chemical CO₂ removal
**Monitoring**: CO₂ level analysis
**Maintenance**: Regular scrubber replacement
**Backup**: Multiple scrubber systems

## Practice Scenarios

### Scenario 1: Oxygen Level Drop
The oxygen level in the chamber drops to 0.3 ATA. What's your response?

**AI Tutor Response**:
1. **Immediate**: Increase oxygen flow to chamber
2. **Monitor**: Watch oxygen level recovery
3. **Investigate**: Check for system leaks or failures
4. **Backup**: Activate backup oxygen supply if needed
5. **Document**: Record incident and actions taken

### Scenario 2: CO₂ Scrubber Failure
A CO₂ scrubber shows signs of exhaustion. What's your action?

**AI Tutor Response**:
1. **Switch**: Activate backup scrubber system
2. **Monitor**: Check CO₂ levels closely
3. **Replace**: Install fresh scrubber material
4. **Test**: Verify proper operation
5. **Log**: Document maintenance action

## Equipment Maintenance Procedures

### Daily Checks
- Gas analyzer calibration
- Scrubber material condition
- System pressure verification
- Emergency equipment status

### Weekly Maintenance
- Detailed system inspection
- Filter replacement
- Backup system testing
- Calibration verification

### Monthly Procedures
- Complete system overhaul
- Documentation review
- Training requirement updates
- Equipment inventory

## Emergency Response Skills

### Emergency Scenarios
**Power Failure**: Switch to backup power systems
**Gas Contamination**: Identify source and eliminate
**Equipment Failure**: Implement backup procedures
**Communication Loss**: Restore essential communications

**AI Tutor Challenge**: Practice emergency scenarios regularly to maintain proficiency.

---

*Continue learning with our advanced LST and NDT modules to complete your professional diving certification.*`
  },
  {
    title: 'ALST Gas Analysis Procedures',
    content: `# Gas Analysis Procedures for ALST

## Introduction
Gas analysis is critical for maintaining safe breathing environments in diving operations. This lesson covers the essential procedures and equipment used by Assistant Life Support Technicians.

## Gas Analysis Equipment

### Oxygen Analyzers
- **Galvanic Cell Analyzers**: Real-time oxygen monitoring
- **Paramagnetic Analyzers**: High-precision oxygen measurement
- **Calibration**: Daily calibration with known gas standards
- **Maintenance**: Regular sensor replacement and cleaning

### Helium Analyzers
- **Thermal Conductivity**: Helium concentration measurement
- **Mass Spectrometry**: Precise gas composition analysis
- **Response Time**: Understanding analyzer lag times
- **Accuracy**: ±0.1% for critical applications

### CO₂ Analyzers
- **Infrared Sensors**: Real-time CO₂ monitoring
- **Chemical Indicators**: Backup CO₂ detection
- **Alarm Limits**: Set at 0.5% CO₂ maximum
- **Response**: Immediate scrubber activation

## Analysis Procedures

### Pre-Analysis Setup
1. **Calibration Check**: Verify all analyzers with known standards
2. **Sample Line Purge**: Clear sample lines of residual gases
3. **Flow Rate Setting**: Establish proper sample flow rates
4. **Data Logging**: Initialize recording systems

### Continuous Monitoring
- **Oxygen**: Maintain 0.4-0.6 ATA partial pressure
- **Helium**: Monitor diluent gas concentration
- **CO₂**: Keep below 0.5% at all times
- **Trace Gases**: Watch for contamination indicators

### Emergency Analysis
**Rapid Response**: Quick analysis during emergencies
**Backup Methods**: Manual testing when analyzers fail
**Communication**: Report findings to dive supervisor
**Documentation**: Record all emergency measurements

## Quality Control

### Standards and Calibration
- **Primary Standards**: NIST-traceable gas standards
- **Secondary Standards**: Working gas mixtures
- **Frequency**: Calibrate before each operation
- **Documentation**: Maintain calibration records

### Accuracy Verification
- **Cross-checking**: Compare multiple analyzer readings
- **Known Mixtures**: Test with certified gas blends
- **Linearity Checks**: Verify response across ranges
- **Drift Monitoring**: Track analyzer stability

## Troubleshooting Common Issues

### Oxygen Analyzer Problems
**Slow Response**: Check sample flow rates and sensor condition
**Drift**: Recalibrate or replace sensor
**Erratic Readings**: Check for electrical interference
**No Response**: Verify power supply and connections

### Helium Analyzer Issues
**Background Interference**: Check for air leaks in sample system
**Calibration Drift**: Recalibrate with helium standard
**Temperature Effects**: Account for temperature compensation
**Flow Problems**: Verify sample flow rates

**Practical Exercise**: Practice troubleshooting scenarios with instructor guidance.`
  }
];

// LST Advanced Lessons
const lstLessonsContent = [
  {
    title: 'AI Tutor: LST Advanced Systems',
    content: `# AI Tutor: Life Support Technician Advanced Systems

## Welcome to Your LST AI Tutor

I'm your specialized AI tutor for Life Support Technician training. I'll guide you through advanced life support systems, troubleshooting, and team leadership.

## Learning Objectives
- Master advanced life support systems
- Understand system design principles
- Learn troubleshooting methodologies
- Develop emergency management skills
- Practice team leadership techniques

## Advanced Life Support Systems

### System Design Principles
**Redundancy**: Multiple backup systems for critical functions
**Modularity**: Systems that can be isolated and repaired
**Monitoring**: Comprehensive monitoring of all parameters
**Safety**: Fail-safe design with automatic protection

**AI Tutor Tip**: Good system design prevents failures before they occur.

### Gas Management Systems
**Primary Supply**: High-pressure gas storage and distribution
**Backup Systems**: Independent backup gas supplies
**Analysis Equipment**: Multiple gas analyzers for redundancy
**Control Systems**: Automatic and manual control capabilities

### Environmental Control
**Temperature Management**: Heating and cooling systems
**Humidity Control**: Moisture management systems
**Air Quality**: Filtration and purification systems
**Pressure Control**: Chamber pressure management

## Troubleshooting Methodologies

### Systematic Approach
1. **Identify Problem**: Define the issue clearly
2. **Gather Information**: Collect relevant data
3. **Analyze Options**: Consider possible solutions
4. **Implement Solution**: Execute chosen solution
5. **Verify Results**: Confirm problem resolution
6. **Document Actions**: Record all actions taken

### Common Issues
**Gas Contamination**: Identify and eliminate contamination sources
**Equipment Failure**: Diagnose and repair or replace equipment
**System Malfunction**: Identify root cause and correct
**Communication Problems**: Restore communication systems

## Emergency Management Skills

### Crisis Leadership
**Calm Decision Making**: Maintain composure under pressure
**Clear Communication**: Provide clear, concise instructions
**Resource Management**: Optimize available resources
**Team Coordination**: Direct team members effectively

### Emergency Protocols
**Immediate Response**: React quickly to life-threatening situations
**Escalation Procedures**: Know when to call for additional help
**Evacuation Plans**: Implement emergency evacuation when necessary
**Recovery Operations**: Manage post-emergency recovery

**AI Tutor Challenge**: Leadership skills develop through practice and real-world experience.

## Advanced Troubleshooting

### System Diagnostics
**Data Analysis**: Interpret system performance data
**Pattern Recognition**: Identify recurring problems
**Predictive Maintenance**: Anticipate equipment failures
**Root Cause Analysis**: Find underlying causes of problems

### Complex Problems
**Multiple System Failures**: Handle cascading failures
**Intermittent Issues**: Diagnose sporadic problems
**Environmental Factors**: Account for external conditions
**Human Factors**: Consider operator error possibilities

---

*Master these advanced skills to become a qualified Life Support Technician leader.*`
  }
];

// NDT Lessons Content  
const ndtLessonsContent = [
  {
    title: 'AI Tutor: Visual Inspection Fundamentals',
    content: `# AI Tutor: Visual Inspection Fundamentals

## Welcome to Your NDT AI Tutor

I'm your specialized AI tutor for Non-Destructive Testing and Inspection. I'll guide you through the fundamentals of visual inspection with real-world applications and industry best practices.

## Learning Objectives
- Master visual inspection principles and techniques
- Understand equipment requirements and selection
- Learn systematic inspection procedures
- Develop documentation and reporting skills
- Identify common surface defects and anomalies

## Core Concepts

### What is Visual Inspection?
Visual inspection is the primary and most fundamental NDT method used in underwater inspection. It provides immediate assessment of surface conditions and is often the first step in any inspection program.

**Key Principle**: "If you can see it, you can document it."

### Equipment Requirements
- **High-intensity underwater lights**: Minimum 10,000 lumens for deep water
- **Video recording equipment**: 4K resolution with macro capabilities
- **Measuring tools and scales**: Calibrated rulers and depth gauges
- **Clean surfaces for reference**: Standard cleaning materials

## Inspection Procedures

### 1. Pre-inspection Planning
- Review previous inspection reports
- Identify areas of concern
- Plan inspection sequence
- Check equipment functionality

### 2. Surface Preparation
- Remove marine growth where necessary
- Clean surfaces for better visibility
- Mark inspection areas
- Establish reference points

### 3. Systematic Inspection
- Follow predetermined grid patterns
- Document all findings with photos/video
- Measure defect dimensions
- Record environmental conditions

## Common Defects to Identify

### Corrosion Types
- **General Corrosion**: Uniform metal loss across surface
- **Pitting Corrosion**: Localized deep penetration
- **Galvanic Corrosion**: Accelerated corrosion of less noble metal
- **Crevice Corrosion**: Corrosion in confined spaces

### Structural Defects
- **Cracks**: Linear defects requiring immediate attention
- **Weld Defects**: Poor penetration, undercut, or porosity
- **Mechanical Damage**: Impact damage or wear patterns
- **Fatigue**: Stress-related cracking patterns

## Documentation Standards

### Photography Requirements
**Lighting**: Even, shadow-free illumination
**Scale References**: Include measurement scales in all photos
**Multiple Angles**: Document defects from various viewpoints
**High Resolution**: Minimum 4K for detailed documentation

### Report Writing
**Clear Descriptions**: Use standard terminology
**Accurate Measurements**: Record precise dimensions
**Severity Assessment**: Classify defect severity levels
**Recommendations**: Provide clear action recommendations

**AI Tutor Tip**: Good documentation today prevents confusion tomorrow.

## Quality Assurance

### Inspection Standards
**Industry Codes**: Follow applicable inspection standards
**Client Requirements**: Meet specific client specifications
**Regulatory Compliance**: Ensure regulatory compliance
**Best Practices**: Apply industry best practices

### Verification Methods
**Peer Review**: Have experienced inspectors review findings
**Calibration**: Regular equipment calibration
**Training**: Continuous skill development
**Documentation**: Maintain inspection records

---

*Progress to advanced NDT methods including ultrasonic and magnetic particle testing.*`
  }
];

// Function to import content to database
export async function importRepositoryContent() {
  try {
    console.log('Starting content import from repositories...');

    // Get existing track IDs (tracks already created from previous run)
    const alstTrackResult = await db.execute(`
      SELECT id FROM tracks WHERE slug = 'alst-training'
    `);
    const alstTrackId = alstTrackResult.rows[0]?.id;

    const lstTrackResult = await db.execute(`
      SELECT id FROM tracks WHERE slug = 'lst-training'
    `);
    const lstTrackId = lstTrackResult.rows[0]?.id;

    const ndtTrackResult = await db.execute(`
      SELECT id FROM tracks WHERE slug = 'ndt-training'
    `);
    const ndtTrackId = ndtTrackResult.rows[0]?.id;

    console.log(`Found track IDs: ALST=${alstTrackId}, LST=${lstTrackId}, NDT=${ndtTrackId}`);

    // Insert ALST Lessons
    for (let i = 0; i < alstLessonsContent.length; i++) {
      const lessonTitle = alstLessonsContent[i].title.replace(/'/g, "''");
      const lessonContent = alstLessonsContent[i].content.replace(/'/g, "''");
      await db.execute(`
        INSERT INTO lessons (track_id, title, "order", content, estimated_minutes, is_required) 
        VALUES ('${alstTrackId}', '${lessonTitle}', ${i + 1}, '${lessonContent}', 60, true)
      `);
    }

    // Insert LST Lessons
    for (let i = 0; i < lstLessonsContent.length; i++) {
      const lessonTitle = lstLessonsContent[i].title.replace(/'/g, "''");
      const lessonContent = lstLessonsContent[i].content.replace(/'/g, "''");
      await db.execute(`
        INSERT INTO lessons (track_id, title, "order", content, estimated_minutes, is_required) 
        VALUES ('${lstTrackId}', '${lessonTitle}', ${i + 1}, '${lessonContent}', 90, true)
      `);
    }

    // Insert NDT Lessons
    for (let i = 0; i < ndtLessonsContent.length; i++) {
      const lessonTitle = ndtLessonsContent[i].title.replace(/'/g, "''");
      const lessonContent = ndtLessonsContent[i].content.replace(/'/g, "''");
      await db.execute(`
        INSERT INTO lessons (track_id, title, "order", content, estimated_minutes, is_required) 
        VALUES ('${ndtTrackId}', '${lessonTitle}', ${i + 1}, '${lessonContent}', 75, true)
      `);
    }

    console.log('Successfully imported content from both repositories!');
    console.log(`Created tracks: ALST, LST, NDT`);
    console.log(`Total lessons imported: ${alstLessonsContent.length + lstLessonsContent.length + ndtLessonsContent.length}`);

    return {
      success: true,
      tracksCreated: 3,
      lessonsImported: alstLessonsContent.length + lstLessonsContent.length + ndtLessonsContent.length
    };

  } catch (error: any) {
    console.error('Error importing repository content:', error);
    return {
      success: false,
      error: error?.message || 'Unknown error occurred'
    };
  }
}